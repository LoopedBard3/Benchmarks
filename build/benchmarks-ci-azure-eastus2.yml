# Do not change this file, it is generated using these steps:
# - The file benchmarks.matrix.yml defines how each job is run in parallel
# - Convert its content to json using https://jsonformatter.org/yaml-to-json
# - Use the template in benchmarks.template.liquid and the converted json using https://liquidjs.com/playground.html
# - Update this file with the result of the template generation

trigger: none
pr: none

schedules:
- cron: "0 9/12 * * *"
  always: true # always run the pipeline even if there have not been source code changes since the last successful scheduled run.
  branches:
    include:
    - main

variables:
  - name: session
    value: $(Build.BuildNumber)
  - name: buildId
    value: $(Build.BuildId)
  - name: buildNumber
    value: $(Build.BuildNumber)
  - name: am
    value: $[lt(format('{0:HH}', pipeline.startTime), 12)]
  - name: pm
    value: $[ge(format('{0:HH}', pipeline.startTime), 12)]
  - name: plaintextJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/plaintext.benchmarks.yml
  - name: htmlJobs
    value: -j https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/Benchmarks/benchmarks.html.json
  - name: jsonJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/json.benchmarks.yml
  - name: multiQueryJobs
    value: -j https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/Benchmarks/benchmarks.multiquery.json
  - name: basicApiJobs
    value: --database MySql --jobs https://raw.githubusercontent.com/dotnet/aspnetcore/main/src/Mvc/benchmarkapps/BasicApi/benchmarks.json
  - name: basicViewsJobs
    value: --database MySql --jobs https://raw.githubusercontent.com/dotnet/aspnetcore/main/src/Mvc/benchmarkapps/BasicViews/benchmarks.json
  - name: http2Jobs
    value: --client-name H2Load -p Streams=70 --headers None
  - name: blazorJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/blazor.benchmarks.yml
  - name: plaintextPlatformJobs
    value: -j https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/TechEmpower/PlatformBenchmarks/benchmarks.plaintext.json
  - name: jsonPlatformJobs
    value: -j https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/TechEmpower/PlatformBenchmarks/benchmarks.json.json
  - name: htmlPlatformJobs
    value: -j  https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/TechEmpower/PlatformBenchmarks/benchmarks.html.json
  - name: blazorWasmJobs
    value: --config https://raw.githubusercontent.com/dotnet/aspnetcore/main/src/Components/benchmarkapps/Wasm.Performance/benchmarks.compose.json
  - name: mvcJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/Mvc/benchmarks.mvcjson.yml
  - name: crudApiJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/Mvc/benchmarks.crudapi.yml
  - name: crudApiCertJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/Mvc/benchmarks.certapi.yml
  - name: crudApiJwtJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/Mvc/benchmarks.jwtapi.yml
  - name: signalRJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/signalr.benchmarks.yml
  - name: websocketJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/websocket.benchmarks.yml
  - name: proxyJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/proxy.benchmarks.yml
  - name: proxyGRPCJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/proxy.grpc.benchmarks.yml
  - name: h2loadConnectionsCount
    value: 28
  - name: platformJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/platform.benchmarks.yml
  - name: databaseJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/database.benchmarks.yml
  - name: antiforgeryJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/antiforgery.benchmarks.yml
  - name: tlsJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/tls.benchmarks.yml
  - name: rejectionJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/rejection.benchmarks.yml
  - name: goldilocksJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/goldilocks.benchmarks.yml
  - name: monoJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/mono.benchmarks.yml --application.options.requiredOperatingSystem linux
  - name: azureProfile
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/build/azure.profile.yml
  - name: ciProfile
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/build/ci.profile.yml
  - name: grpcJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/grpc.benchmarks.yml
  - name: efcoreJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/efcore.benchmarks.yml
  - name: buildJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/src/BenchmarksApps/BuildPerformance/buildperformance.yml
  - name: orchardJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/orchard.benchmarks.yml
  - name: containerMatrixJobs
    value: --config https://raw.githubusercontent.com/aspnet/Benchmarks/main/scenarios/containers.benchmarks.yml
  - name: minimalJobs
    value: --config https://github.com/aspnet/Benchmarks/blob/main/src/BenchmarksApps/TechEmpower/Minimal/minimal.benchmarks.yml?raw=true
  - name: blazorSsrJobs
    value: --config https://github.com/aspnet/Benchmarks/blob/main/src/BenchmarksApps/TechEmpower/BlazorSSR/blazorssr.benchmarks.yml?raw=true
  - name: razorPagesJobs
    value: --config https://github.com/aspnet/Benchmarks/blob/main/src/BenchmarksApps/TechEmpower/RazorPages/razorpages.benchmarks.yml?raw=true

jobs:

# GROUP 1

- job: Containers_Cobalt_Cloud_Lin_Server
  displayName: 1- Containers Cobalt Cloud Lin Server
  pool: server
  timeoutInMinutes: 120
  dependsOn: []
  condition: succeededOrFailed()
  steps:
  - template: containers-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 2

- job: Containers_Cobalt_Cloud_Lin_Server_Azure_Linux3
  displayName: 2- Containers Cobalt Cloud Lin Server Azure Linux3
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Containers_Cobalt_Cloud_Lin_Server]
  condition: succeededOrFailed()
  steps:
  - template: containers-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-azure-linux3-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 3

- job: Baselines_Database_Cobalt_Cloud_Lin_Server
  displayName: 3- Baselines Database Cobalt Cloud Lin Server
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Containers_Cobalt_Cloud_Lin_Server_Azure_Linux3]
  condition: succeededOrFailed()
  steps:
  - template: baselines-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 4

- job: Baselines_Database_Cobalt_Cloud_Lin_Server_Azure_Linux3
  displayName: 4- Baselines Database Cobalt Cloud Lin Server Azure Linux3
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Database_Cobalt_Cloud_Lin_Server]
  condition: succeededOrFailed()
  steps:
  - template: baselines-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-azure-linux3-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 5

- job: Baselines_Cobalt_Cloud_Lin_Server
  displayName: 5- Baselines Cobalt Cloud Lin Server
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Database_Cobalt_Cloud_Lin_Server_Azure_Linux3]
  condition: succeededOrFailed()
  steps:
  - template: baselines-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-app --profile cobalt-cloud-lin-client-load "
      
# GROUP 6

- job: Baselines_Cobalt_Cloud_Lin_Server_Azure_Linux3
  displayName: 6- Baselines Cobalt Cloud Lin Server Azure Linux3
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Cobalt_Cloud_Lin_Server]
  condition: succeededOrFailed()
  steps:
  - template: baselines-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-azure-linux3-app --profile cobalt-cloud-lin-client-load "
      
# GROUP 7

- job: MVC_Cobalt_Cloud_Lin_Server
  displayName: 7- MVC Cobalt Cloud Lin Server
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Cobalt_Cloud_Lin_Server_Azure_Linux3]
  condition: succeededOrFailed()
  steps:
  - template: mvc-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 8

- job: MVC_Cobalt_Cloud_Lin_Server_Azure_Linux3
  displayName: 8- MVC Cobalt Cloud Lin Server Azure Linux3
  pool: server
  timeoutInMinutes: 120
  dependsOn: [MVC_Cobalt_Cloud_Lin_Server]
  condition: succeededOrFailed()
  steps:
  - template: mvc-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-azure-linux3-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 9

- job: Trends_Cobalt_Cloud_Lin_Server
  displayName: 9- Trends Cobalt Cloud Lin Server
  pool: server
  timeoutInMinutes: 120
  dependsOn: [MVC_Cobalt_Cloud_Lin_Server_Azure_Linux3]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-app --profile cobalt-cloud-lin-client-load "
      
# GROUP 10

- job: Trends_Cobalt_Cloud_Lin_Server_Azure_Linux3
  displayName: 10- Trends Cobalt Cloud Lin Server Azure Linux3
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Cobalt_Cloud_Lin_Server]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-azure-linux3-app --profile cobalt-cloud-lin-client-load "
      
# GROUP 11

- job: Trends_Database_Cobalt_Cloud_Lin_Server
  displayName: 11- Trends Database Cobalt Cloud Lin Server
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Cobalt_Cloud_Lin_Server_Azure_Linux3]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
# GROUP 12

- job: Trends_Database_Cobalt_Cloud_Lin_Server_Azure_Linux3
  displayName: 12- Trends Database Cobalt Cloud Lin Server Azure Linux3
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Database_Cobalt_Cloud_Lin_Server]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: cobaltcloud
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile cobalt-cloud-lin-server-azure-linux3-app --profile cobalt-cloud-lin-client-load --profile cobalt-cloud-lin-db-db "
      
